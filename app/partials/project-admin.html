<header class="header-container" ng-include="'/partials/header.html'"></header>

<main class="project-admin-view">

    <ul class="tabs clearfix">
        <li class="userstory-tab" ng-class="{active: isActive('data')}"
            ng-click="setActive('data')" i18next="admin.project-profile">
            Project profile
        </li>
        <li class="userstory-tab" ng-class="{active: isActive('sprints')}"
            ng-click="setActive('sprints')" i18next="admin.sprints">
            Sprints
        </li>
        <li class="userstory-tab" ng-class="{active: isActive('memberships')}"
            ng-click="setActive('memberships')" i18next="admin.memberships">
            Memberships
        </li>
    </ul>

    <div class="tab-container" ng-show="isActive('sprints')">
        <div class="sprint-list-container">
            <h3 data-icon="q" i18next="admin.created-sprints">Created sprints</h3>
            <ul class="sprint-list">
                <li class="sprint" ng-repeat="ml in project.list_of_milestones">
                    <a href="" data-icon="h" title="Delete sprint" i18next="title:admin.delete-sprint" ng-click="deleteMilestone(ml)"></a>
                    {{ ml.name }}
                </li>
            </ul>
        </div>
    </div>

    <div class="tab-container" ng-show="isActive('data')">
        <div class="update-form">
            <form class="form-horizontal" gm-checksley-form="submit()">

                <fieldset class="project-name">
                    <label class="control-label" for="name" i18next="admin.name">Name:</label>
                    <input type="text" id="name" name="name" ng-model="project.name" data-error-message="Required" />
                </fieldset>

                <fieldset class="project-slug">
                    <label for="slug" i18next="admin.slug">Slug:</label>
                    <input type="text" id="slug" name="slug" ng-model="project.slug" data-error-message="Required" />
                </fieldset>

                <fieldset class="project-total-milestones">
                    <label class="control-label" for="total_milestones" i18next="admin.num-of-sprints">Num. Sprints:</label>
                    <input type="text" id="total_milestones" name="total_milestones"
                        ng-model="project.total_milestones" data-error-message="Required" />
                </fieldset>

                <fieldset class="project-total-story-points">
                    <label for="slug" i18next="admin.total-story-points">Total story-points:</label>
                    <input type="text" id="total_story_points" name="total_story_points"
                        ng-model="project.total_story_points" data-error-message="Required" />
                </fieldset>

                <fieldset class="project-description">
                    <label for="description" i18next="admin.description">Description:</label>
                    <textarea id="description" name="description" ng-model="project.description"></textarea>
                </fieldset>

                <fieldset class="project-default-points">
                    <label for="default_points" i18next="admin.default-points">Default value for points selectors:</label>
                    <select id="default_points" name="default_points"
                            ng-model="project.default_points"
                            ng-options="c.id as c.name for c in constants.pointsList|orderBy:'order'">
                        <option value="">--------</option>
                    </select>
                </fieldset>

                <fieldset class="project-default-us-status">
                    <label for="default_us_status" i18next="admin.default-us-status">Default value for US status selectors:</label>
                    <select id="default_us_status" name="default_us_status"
                            ng-model="project.default_us_status"
                            ng-options="c.id as c.name for c in constants.usStatusesList|orderBy:'order'">
                        <option value="">--------</option>
                    </select>
                </fieldset>

                <fieldset class="project-default-task-status">
                    <label for="default_task_status" i18next="admin.default-task-status">Default value for task status selectors:</label>
                    <select id="default_task_status" name="default_task_status"
                            ng-model="project.default_task_status"
                            ng-options="c.id as c.name for c in constants.taskStatusesList|orderBy:'order'">
                        <option value="">--------</option>
                    </select>
                </fieldset>

                <fieldset class="project-default-priority">
                    <label for="default_priority" i18next="admin.default-priority">Default value for priority selectors:</label>
                    <select id="default_priority" name="default_priority"
                            ng-model="project.default_priority"
                            ng-options="c.id as c.name for c in constants.prioritiesList|orderBy:'order'">
                        <option value="">--------</option>
                    </select>
                </fieldset>

                <fieldset class="project-default-severity">
                    <label for="default_severity" i18next="admin.default-severity">Default value for severity selectors:</label>
                    <select id="default_severity" name="default_severity"
                            ng-model="project.default_severity"
                            ng-options="c.id as c.name for c in constants.severitiesList|orderBy:'order'">
                        <option value="">--------</option>
                    </select>
                </fieldset>

                <fieldset class="project-default-issue-type">
                    <label for="default_issue_type" i18next="admin.default-issue-type">Default value for issue type selectors:</label>
                    <select id="default_issue_type" name="default_issue_type"
                            ng-model="project.default_issue_type"
                            ng-options="c.id as c.name for c in constants.issueTypesList|orderBy:'order'">
                        <option value="">--------</option>
                    </select>
                </fieldset>

                <fieldset class="project-default-issue-status">
                    <label for="default_issue_status" i18next="admin.default-issue-status">Default value for issue status selectors:</label>
                    <select id="default_issue_status" name="default_issue_status"
                            ng-model="project.default_issue_status"
                            ng-options="c.id as c.name for c in constants.issueStatusesList|orderBy:'order'">
                        <option value="">--------</option>
                    </select>
                </fieldset>

                <fieldset class="project-submit">
                    <button type="submit" class="button button-edit" gm-checksley-submit-button i18next="admin.save">Save</button>
                </fieldset>

            </form>
        </div>
    </div>
    <div class="tab-container" ng-show="isActive('memberships')">
        <div class="project-members">
            <div class="project-members-options">
                <a href="" class="add-member" data-icon="A" title="Add member"
                    ng-click="toggleForm()" i18next="title:admin.add-member,admin.add-member">Add member</a>
            </div>
            <div class="invitation-form">
                <div class="add-member-form" ng-show="formOpened">
                    <h4 i18next="admin.add-new-member">Add new member</h4>
                    <form gm-checksley-form="submitMembership()">
                        <fieldset>
                            <label class="control-label" for="role" i18next="admin.role">Role</label>
                            <select id="role" name="role" ng-model="membership.role" data-required="true"
                                    ng-options="r.id as r.name for r in constants.rolesList|orderBy:'order'">
                            </select>
                        </fieldset>
                        <fieldset class="project-name">
                            <label class="control-label" for="email" i18next="admin.email">Email address</label>
                            <input type="text" id="email" ng-model="membership.email"
                                data-required="true" />
                        </fieldset>
                        <fieldset>
                            <button type="submit" class="button button-edit"  gm-checksley-submit-button i18next="admin.add-member">Add member</button>
                            <button type="submit" class="button button-cancel" ng-click="closeForm()" i18next="admin.cancel">Cancel</button>
                        </fieldset>
                    </form>
                </div>
            </div>
            <div class="project-members-list" >
                <table class="membership-list">
                    <thead>
                        <tr>
                            <th class="user">Full name</td>
                            <th class="email">Email</td>
                            <th class="role">Role</th>
                            <th class="status">Status</td>
                            <th class="options"></td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="mbr in project.memberships">
                            <td class="user"><span class="user" gm-colorize-user="constants.users[mbr.user]">{{ memberName(mbr) }}</span></td>
                            <td class="email"><span class="email">{{ memberEmail(mbr) }}</span></td>
                            <td class="role"><span class="role">[<a href="" gm-popover="updateMemberRole(mbr, selectedId)" data-auto-hide="true"
                                        data-tmpl="#role-popover">{{ mbr.role_name }}</a>]</span></td>

                            <td class="status"><span class="status">{{ memberStatus(mbr) }}</span></td>
                            <td class="options">
                                <a href="" data-icon="h"  title="Delete Member" ng-click="deleteMember(mbr)" i18next="title:admin.delete-member"></a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <!-- <a class="button button-delete" ng-click="deleteProject()">Delete project</a>-->
</main>

<script type="text/template" id="role-popover">
    <div class="role-popover">
        <p class="title" i18next="admin.select-role">Select role:</p>
        <ul>
            <li ng-repeat="obj in constants.rolesList|orderBy:'order'">
                <a href="" data-id="{{ obj.id }}" class="btn-accept">{{ obj.name }}</a>
            </li>
        </ul>
    </div>
</script>
